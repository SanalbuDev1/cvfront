<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo: async vs defer vs normal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d9ff;
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .explanation {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .explanation h2 {
            color: #ffd700;
            margin-bottom: 15px;
        }
        .explanation ul {
            margin-left: 20px;
            line-height: 1.8;
        }
        .explanation code {
            background: #2d2d2d;
            padding: 2px 8px;
            border-radius: 4px;
            color: #00ff88;
            font-family: 'Consolas', monospace;
        }
        .demo-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .demo-box {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .demo-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .demo-box.normal { border-color: #ff6b6b; }
        .demo-box.defer { border-color: #4ecdc4; }
        .demo-box.async { border-color: #ffe66d; }
        .demo-box h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }
        .badge.normal { background: #ff6b6b; color: #000; }
        .badge.defer { background: #4ecdc4; color: #000; }
        .badge.async { background: #ffe66d; color: #000; }
        .log-container {
            background: #0d0d0d;
            border-radius: 10px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 0.85em;
        }
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
        }
        .log-entry:last-child { border-bottom: none; }
        .log-entry .time {
            color: #888;
            font-size: 0.9em;
        }
        .test-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
        }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .btn-normal { background: #ff6b6b; color: #000; }
        .btn-defer { background: #4ecdc4; color: #000; }
        .btn-async { background: #ffe66d; color: #000; }
        .btn-all { background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #ffe66d); color: #000; }
        .timeline {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }
        .timeline h2 {
            color: #00d9ff;
            margin-bottom: 20px;
            text-align: center;
        }
        #timeline-visual {
            position: relative;
            height: 150px;
            background: #0d0d0d;
            border-radius: 10px;
            overflow: hidden;
        }
        .timeline-bar {
            position: absolute;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-size: 0.8em;
            font-weight: bold;
            transition: width 0.5s ease;
        }
        .timeline-bar.html { top: 10px; background: #9b59b6; }
        .timeline-bar.normal-script { top: 50px; background: #ff6b6b; }
        .timeline-bar.defer-script { top: 90px; background: #4ecdc4; }
        .timeline-bar.async-script { top: 130px; background: #ffe66d; color: #000; }
        .result-summary {
            background: rgba(0,217,255,0.1);
            border: 2px solid #00d9ff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        #dom-content {
            background: rgba(155, 89, 182, 0.2);
            border: 2px dashed #9b59b6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .highlight {
            animation: pulse 1s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; background: rgba(255,255,255,0.2); }
        }
        .code-example {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        .code-example .comment { color: #6a9955; }
        .code-example .tag { color: #569cd6; }
        .code-example .attr { color: #9cdcfe; }
        .code-example .string { color: #ce9178; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Prueba de Concepto: async vs defer vs Normal</h1>
        
        <div class="explanation">
            <h2>üìö ¬øCu√°l es la diferencia?</h2>
            <ul>
                <li><code>&lt;script src="..."&gt;</code> <strong>(Normal):</strong> Bloquea el parsing HTML hasta que descarga Y ejecuta el script</li>
                <li><code>&lt;script defer&gt;</code> <strong>(Diferido):</strong> Descarga en paralelo, ejecuta DESPU√âS de que el DOM est√© listo (en orden)</li>
                <li><code>&lt;script async&gt;</code> <strong>(As√≠ncrono):</strong> Descarga en paralelo, ejecuta TAN PRONTO como descarga (sin orden garantizado)</li>
            </ul>
            
            <div class="code-example">
                <span class="comment">&lt;!-- ‚ùå NORMAL: Bloquea todo --&gt;</span><br>
                <span class="tag">&lt;script</span> <span class="attr">src=</span><span class="string">"script.js"</span><span class="tag">&gt;&lt;/script&gt;</span><br><br>
                
                <span class="comment">&lt;!-- ‚úÖ DEFER: Espera al DOM, mantiene orden --&gt;</span><br>
                <span class="tag">&lt;script</span> <span class="attr">src=</span><span class="string">"app.js"</span> <span class="attr">defer</span><span class="tag">&gt;&lt;/script&gt;</span><br><br>
                
                <span class="comment">&lt;!-- ‚úÖ ASYNC: Independiente, para analytics --&gt;</span><br>
                <span class="tag">&lt;script</span> <span class="attr">src=</span><span class="string">"analytics.js"</span> <span class="attr">async</span><span class="tag">&gt;&lt;/script&gt;</span>
            </div>
        </div>

        <!-- Este div simula contenido del DOM que los scripts necesitan manipular -->
        <div id="dom-content">
            <h3>üìÑ Contenido del DOM</h3>
            <p>Este elemento existe en el HTML. Los scripts intentar√°n acceder a √©l.</p>
            <p id="dom-status">Estado: Esperando scripts...</p>
        </div>

        <div class="test-buttons">
            <button class="btn btn-all" onclick="runFullDemo()">
                ‚ñ∂Ô∏è Ejecutar Demo Completa
            </button>
            <button class="btn btn-normal" onclick="clearLogs()">
                üóëÔ∏è Limpiar Logs
            </button>
        </div>

        <div class="demo-section">
            <!-- Script Normal -->
            <div class="demo-box normal">
                <h3><span class="badge normal">NORMAL</span> Sin atributos</h3>
                <p style="margin-bottom: 10px; font-size: 0.9em; color: #aaa;">
                    Bloquea el renderizado. El navegador espera a que descargue y ejecute antes de continuar.
                </p>
                <div class="log-container" id="log-normal"></div>
            </div>

            <!-- Script Defer -->
            <div class="demo-box defer">
                <h3><span class="badge defer">DEFER</span> Diferido</h3>
                <p style="margin-bottom: 10px; font-size: 0.9em; color: #aaa;">
                    Se descarga en paralelo pero espera al DOM. Ideal para scripts que manipulan el HTML.
                </p>
                <div class="log-container" id="log-defer"></div>
            </div>

            <!-- Script Async -->
            <div class="demo-box async">
                <h3><span class="badge async">ASYNC</span> As√≠ncrono</h3>
                <p style="margin-bottom: 10px; font-size: 0.9em; color: #aaa;">
                    Se descarga y ejecuta cuando est√° listo. Ideal para scripts independientes (analytics, ads).
                </p>
                <div class="log-container" id="log-async"></div>
            </div>
        </div>

        <div class="timeline">
            <h2>üìä L√≠nea de Tiempo de Ejecuci√≥n</h2>
            <div id="timeline-visual">
                <div class="timeline-bar html" style="width: 0%; left: 0;">HTML Parsing</div>
                <div class="timeline-bar normal-script" style="width: 0%; left: 0;">Script Normal</div>
                <div class="timeline-bar defer-script" style="width: 0%; left: 0;">Script Defer</div>
                <div class="timeline-bar async-script" style="width: 0%; left: 0;">Script Async</div>
            </div>
        </div>

        <div class="result-summary" id="result-summary" style="display: none;">
            <h3>üìã Resumen de la Prueba</h3>
            <div id="summary-content"></div>
        </div>

        <div class="explanation" style="margin-top: 30px;">
            <h2>üéØ ¬øCu√°ndo usar cada uno?</h2>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                <tr style="background: rgba(255,255,255,0.1);">
                    <th style="padding: 10px; text-align: left;">Situaci√≥n</th>
                    <th style="padding: 10px; text-align: center;">Recomendaci√≥n</th>
                </tr>
                <tr>
                    <td style="padding: 10px;">Scripts que manipulan el DOM</td>
                    <td style="padding: 10px; text-align: center;"><code>defer</code></td>
                </tr>
                <tr style="background: rgba(255,255,255,0.05);">
                    <td style="padding: 10px;">Google Analytics, tracking, ads</td>
                    <td style="padding: 10px; text-align: center;"><code>async</code></td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Scripts con dependencias entre s√≠ (A necesita B)</td>
                    <td style="padding: 10px; text-align: center;"><code>defer</code> (mantiene orden)</td>
                </tr>
                <tr style="background: rgba(255,255,255,0.05);">
                    <td style="padding: 10px;">Widgets de redes sociales (Twitter, Facebook)</td>
                    <td style="padding: 10px; text-align: center;"><code>async</code></td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Librer√≠as cr√≠ticas (jQuery, React, Vue)</td>
                    <td style="padding: 10px; text-align: center;"><code>defer</code></td>
                </tr>
                <tr style="background: rgba(255,255,255,0.05);">
                    <td style="padding: 10px;">Chat en vivo, soporte</td>
                    <td style="padding: 10px; text-align: center;"><code>async</code></td>
                </tr>
            </table>
        </div>

        <div class="explanation" style="margin-top: 20px; border-color: #ff6b6b;">
            <h2>‚ö†Ô∏è Problema Com√∫n: Script normal en el &lt;head&gt;</h2>
            <p style="margin-bottom: 15px;">Si colocas un script normal en el <code>&lt;head&gt;</code> que intenta acceder al DOM, ¬°fallar√°!</p>
            
            <div class="code-example">
                <span class="tag">&lt;head&gt;</span><br>
                &nbsp;&nbsp;<span class="comment">&lt;!-- ‚ùå ESTO FALLA --&gt;</span><br>
                &nbsp;&nbsp;<span class="tag">&lt;script&gt;</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;document.getElementById('mi-elemento').innerHTML = 'Hola';<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Error: Cannot read property 'innerHTML' of null</span><br>
                &nbsp;&nbsp;<span class="tag">&lt;/script&gt;</span><br>
                <span class="tag">&lt;/head&gt;</span><br>
                <span class="tag">&lt;body&gt;</span><br>
                &nbsp;&nbsp;<span class="tag">&lt;div</span> <span class="attr">id=</span><span class="string">"mi-elemento"</span><span class="tag">&gt;&lt;/div&gt;</span> <span class="comment">&lt;!-- A√∫n no existe cuando el script se ejecuta --&gt;</span><br>
                <span class="tag">&lt;/body&gt;</span>
            </div>
            
            <p style="margin-top: 15px;"><strong>‚úÖ Soluci√≥n:</strong> Usa <code>defer</code> o mueve el script al final del <code>&lt;body&gt;</code></p>
        </div>
    </div>

    <script>
        // Variables globales para tracking
        const startTime = performance.now();
        const events = {
            normal: [],
            defer: [],
            async: []
        };

        // Funci√≥n para agregar logs
        function addLog(type, message, isError = false) {
            const container = document.getElementById(`log-${type}`);
            if (!container) return;
            
            const time = (performance.now() - startTime).toFixed(2);
            const entry = document.createElement('div');
            entry.className = 'log-entry highlight';
            entry.innerHTML = `
                <span style="color: ${isError ? '#ff6b6b' : '#00ff88'}">${message}</span>
                <span class="time">${time}ms</span>
            `;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
            
            events[type].push({ time: parseFloat(time), message, isError });
        }

        // Funci√≥n para limpiar logs
        function clearLogs() {
            ['normal', 'defer', 'async'].forEach(type => {
                const container = document.getElementById(`log-${type}`);
                if (container) container.innerHTML = '';
                events[type] = [];
            });
            document.getElementById('result-summary').style.display = 'none';
            document.getElementById('dom-status').textContent = 'Estado: Esperando scripts...';
            
            // Reset timeline
            document.querySelectorAll('.timeline-bar').forEach(bar => {
                bar.style.width = '0%';
            });
        }

        // Simular comportamiento de script NORMAL (bloqueante)
        function simulateNormalScript() {
            return new Promise(resolve => {
                addLog('normal', '‚è≥ Iniciando descarga...');
                
                // Simular tiempo de descarga (bloquea todo)
                const downloadTime = 800 + Math.random() * 400;
                
                setTimeout(() => {
                    addLog('normal', 'üì• Descarga completada');
                    addLog('normal', '‚ö° Ejecutando script...');
                    
                    // Intentar acceder al DOM
                    const domElement = document.getElementById('dom-content');
                    if (domElement) {
                        addLog('normal', '‚úÖ DOM encontrado correctamente');
                    } else {
                        addLog('normal', '‚ùå ERROR: DOM no disponible!', true);
                    }
                    
                    // Simular trabajo pesado
                    const workTime = 300 + Math.random() * 200;
                    setTimeout(() => {
                        addLog('normal', '‚úîÔ∏è Script completado');
                        resolve();
                    }, workTime);
                }, downloadTime);
            });
        }

        // Simular comportamiento de script DEFER
        function simulateDeferScript() {
            return new Promise(resolve => {
                addLog('defer', '‚è≥ Iniciando descarga (paralela)...');
                
                const downloadTime = 600 + Math.random() * 300;
                
                setTimeout(() => {
                    addLog('defer', 'üì• Descarga completada');
                    addLog('defer', '‚è∏Ô∏è Esperando DOMContentLoaded...');
                    
                    // Defer espera a que el DOM est√© listo
                    setTimeout(() => {
                        addLog('defer', 'üéØ DOM listo, ejecutando...');
                        
                        const domElement = document.getElementById('dom-content');
                        if (domElement) {
                            addLog('defer', '‚úÖ DOM encontrado - ¬°SIEMPRE funciona!');
                            domElement.querySelector('#dom-status').textContent = 
                                'Estado: ‚úÖ Modificado por script DEFER';
                        }
                        
                        setTimeout(() => {
                            addLog('defer', '‚úîÔ∏è Script completado');
                            resolve();
                        }, 200);
                    }, 400);
                }, downloadTime);
            });
        }

        // Simular comportamiento de script ASYNC
        function simulateAsyncScript() {
            return new Promise(resolve => {
                addLog('async', '‚è≥ Iniciando descarga (paralela)...');
                
                // Async puede terminar en cualquier momento
                const downloadTime = 400 + Math.random() * 800;
                
                setTimeout(() => {
                    addLog('async', 'üì• Descarga completada');
                    addLog('async', '‚ö° Ejecutando INMEDIATAMENTE...');
                    
                    // Puede que el DOM est√© o no est√© listo
                    const domElement = document.getElementById('dom-content');
                    if (domElement) {
                        addLog('async', '‚úÖ DOM encontrado (suerte!)');
                    } else {
                        addLog('async', '‚ö†Ô∏è DOM podr√≠a no estar listo', true);
                    }
                    
                    addLog('async', 'üìä Enviando analytics...');
                    
                    setTimeout(() => {
                        addLog('async', '‚úîÔ∏è Script independiente completado');
                        resolve();
                    }, 150);
                }, downloadTime);
            });
        }

        // Animar la l√≠nea de tiempo
        function animateTimeline() {
            const bars = document.querySelectorAll('.timeline-bar');
            
            // HTML parsing
            setTimeout(() => bars[0].style.width = '100%', 100);
            
            // Normal (bloquea)
            setTimeout(() => bars[1].style.width = '40%', 300);
            setTimeout(() => bars[1].style.width = '70%', 800);
            setTimeout(() => bars[1].style.width = '100%', 1200);
            
            // Defer (paralelo, al final)
            setTimeout(() => bars[2].style.width = '60%', 200);
            setTimeout(() => bars[2].style.width = '80%', 600);
            setTimeout(() => bars[2].style.width = '100%', 1800);
            
            // Async (paralelo, cuando termine)
            setTimeout(() => bars[3].style.width = '50%', 150);
            setTimeout(() => bars[3].style.width = '100%', 900);
        }

        // Demo completa
        async function runFullDemo() {
            clearLogs();
            animateTimeline();
            
            // Ejecutar las tres simulaciones en "paralelo"
            await Promise.all([
                simulateNormalScript(),
                simulateDeferScript(),
                simulateAsyncScript()
            ]);
            
            // Mostrar resumen
            showSummary();
        }

        // Mostrar resumen
        function showSummary() {
            const summary = document.getElementById('result-summary');
            const content = document.getElementById('summary-content');
            
            const normalTime = events.normal.length > 0 ? 
                events.normal[events.normal.length - 1].time : 0;
            const deferTime = events.defer.length > 0 ? 
                events.defer[events.defer.length - 1].time : 0;
            const asyncTime = events.async.length > 0 ? 
                events.async[events.async.length - 1].time : 0;
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px;">
                    <div style="background: rgba(255,107,107,0.2); padding: 15px; border-radius: 10px;">
                        <strong style="color: #ff6b6b;">Normal</strong><br>
                        <span style="font-size: 1.5em;">${normalTime.toFixed(0)}ms</span><br>
                        <small>‚ö†Ô∏è Bloquea renderizado</small>
                    </div>
                    <div style="background: rgba(78,205,196,0.2); padding: 15px; border-radius: 10px;">
                        <strong style="color: #4ecdc4;">Defer</strong><br>
                        <span style="font-size: 1.5em;">${deferTime.toFixed(0)}ms</span><br>
                        <small>‚úÖ DOM siempre disponible</small>
                    </div>
                    <div style="background: rgba(255,230,109,0.2); padding: 15px; border-radius: 10px;">
                        <strong style="color: #ffe66d;">Async</strong><br>
                        <span style="font-size: 1.5em;">${asyncTime.toFixed(0)}ms</span><br>
                        <small>üöÄ M√°s r√°pido (independiente)</small>
                    </div>
                </div>
                <p style="margin-top: 20px; color: #aaa;">
                    üí° <strong>Conclusi√≥n:</strong> Usa <code style="color: #4ecdc4;">defer</code> para scripts que necesitan el DOM, 
                    y <code style="color: #ffe66d;">async</code> para scripts independientes como analytics.
                </p>
            `;
            
            summary.style.display = 'block';
        }

        // Log inicial
        console.log('üöÄ Demo de async vs defer cargada');
        addLog('normal', 'üìÑ Esperando demo...');
        addLog('defer', 'üìÑ Esperando demo...');
        addLog('async', 'üìÑ Esperando demo...');
    </script>
</body>
</html>
